<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ hàng</title>
    <link rel="stylesheet" href="assets/fontawesome/css/all.min.css" />
    <!-- <link href="https://fonts.googleapis.com/css2?family=Pontano+Sans&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/cart.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <div>
        <header class="main-header">
            <div class="top-bar">
                <div class="top-bar__row container">
                    <div class="top-bar__row__left">
                        <span>
                            <i class="fab fa-facebook-f"></i>
                        </span>
                        <span>
                            <i class="fab fa-instagram"></i>
                        </span>
                        <span>
                            <i class="fab fa-twitter"></i>
                        </span>
                        <span>
                            <i class="fab fa-youtube"></i>
                        </span>
                    </div>
                    <div class="top-bar__row__right d-flex">
                        <div class="top-bar__row__right__item">
                            <span>
                                USD
                                <i class="fas fa-chevron-down"></i>
                            </span>
                        </div>
                        <div class="top-bar__row__right__item">
                            <span>
                                EN
                                <i class="fas fa-chevron-down"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sub-categories">
            </div>
            <div class="header-sticky-wrapper">
                <div class="header-sticky-wrapper__row container align-items-center">
                    <div class="header-sticky-wrapper__row__logo">
                        <a>
                            <img src="assets/images/logo@2x.png" />
                        </a>
                    </div>
                    <nav class="header-sticky-wrapper__primary-menu d-flex align-items-center">
                        <div class="header-sticky-wrapper__primary-menu__inner align-items-center">
                            <ul
                                class="header-sticky-wrapper__primary-menu__inner__left d-flex align-items-center justify-content-around">
                                <li>
                                    <a href="index.html">
                                        <span>
                                            Trang chủ
                                        </span>
                                    </a>
                                </li>
                                <!-- <li>
                                    <a>
                                        <span>
                                            Shop
                                            <i class="fas fa-chevron-down"></i>
                                        </span>
                                    </a>
                                </li> -->
                                <li class="menu__all-categories">
                                    <a>
                                        <span>
                                            Danh mục sản phẩm
                                            <i class="fas fa-chevron-down"></i>
                                        </span>
                                    </a>
                                </li>
                                <li>
                                    <a href="blog-list.html">
                                        <span>
                                            Tin tức
                                            <!-- <i class="fas fa-chevron-down"></i> -->
                                        </span>
                                    </a>
                                </li>
                                <!-- <li>
                                    <a>
                                        <span>
                                            Pages
                                            <i class="fas fa-chevron-down"></i>
                                        </span>
                                    </a>
                                </li> -->
                                <li>
                                    <a href="about-us.html">
                                        <span>
                                            Giới thiệu
                                        </span>
                                    </a>
                                </li>
                            </ul>
                            <ul
                                class="header-sticky-wrapper__primary-menu__inner__right d-flex align-items-center justify-content-between">
                                <li>
                                    <a>
                                        <i class="fas fa-search"></i>
                                    </a>
                                </li>
                                <li class="wishlist">
                                    <a>
                                        <i class="far fa-heart"></i>
                                        <span class="wishlist-count">0</span>
                                    </a>
                                </li>
                                <li class="cart">
                                    <a href="cart.html">
                                        <i class="fas fa-shopping-cart"></i>
                                        <span class="cart-count">0</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>

            </div>
        </header>
        <div class="wrapper-content">
            <div class="title container d-flex justify-content-between">
                <div>
                    <p>Giỏ hàng</p>
                </div>
                <div>
                    <ul class="d-flex">
                        <li><a href="index.html">Trang chủ</a></li>
                        <li class="active"><a href="#">Giỏ hàng</a></li>
                    </ul>
                </div>
            </div>
            <div class="cart-content container">
                <table class="table">
                    <thead>
                      <tr>
                        <th scope="col"></th>
                        <th scope="col"></th>
                        <th scope="col">Sản phẩm</th>
                        <th scope="col">Giá</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Tổng cộng</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
            </div>
            <div class="cart-total container d-flex justify-content-end">
               
            </div>
        </div>
        <footer>
            <div class="container py-5">
                <div class="d-flex justify-content-between">
                    <div>
                        <img src="assets/images/logo.png">
                    </div>
                    <div>
                        <p class="title"><span class="pr-2"><i class="fas fa-phone"></i></span> Số điện thoại:</p>
                        <span class="ib-sub-title ib-sub-title">
                            Mobile (+00) 987 877 821 <br> Fax 678 912 1289 121
                        </span>
                    </div>
                    <div>
                        <p class="title"><span class="pr-2"><i class="fas fa-home"></i></span>Địa chỉ:</p>
                        <span class="ib-sub-title ib-sub-title">
                            No 40 Baria Sreet 15/2 NewYork <br> City, NY, United States.
                        </span>
                    </div>
                    <div>
                        <p class="title"><span class="pr-2"><i class="far fa-envelope"></i></span>Email:</p>
                        <span class="ib-sub-title ib-sub-title">
                            contact@lustriauk.com <br> contactlustria@gmal.com.
                        </span>
                    </div>
                </div>
                
            </div>
        </footer>
    </div>
    <script src="assets/js/bootstrap-input-spinner.js.js"></script>
    <script src="assets/js/toggle-sub-menu.js"></script>
    <script src="assets/js/generate-product.js"></script>
    <script src="assets/js/category.js"></script>
    <script src="assets/js/cart.js"></script>
    <script>
        function removeCart(productId) {
            let cart = JSON.parse(localStorage.getItem('cart') || '[]')
            cart = cart.filter(({id}) => Number(productId) !== id)
            localStorage.setItem('cart', JSON.stringify(cart))
            generateCart()
            displayCartQuantity()
        }
        function generateCart() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]')
            let productList = cart.map(({id, quantity}) => {
                const product = getProductionById(id)
                product.quantity = quantity
                return product
            })
            if (!productList || productList.length === 0) {
                $('.cart-content table tbody').html('<h3>Giỏ hàng của bạn không có sản phẩm.</h3>')
                $('.cart-total').html('')
            } else {
                const total = productList.reduce((sum, item) => {
                    return sum +(item.priceSale || item.price) * item.quantity
                }, 0)
                let html = productList.map((product) => {
                    return `
                    <tr>
                        <td><a class="remove" onclick=removeCart(${product.id})>X</a></td>
                        <td><a><img src="assets/images/${product.mainImage}.jpg"></a></td>
                        <td>${product.name}</td>
                        <td>${product.priceSale || product.price}.00</td>
                        <td>
                            <input class="quantity product_quantity" type="number" value="${product.quantity}" min="1" max="1000" step="1" size="4"/>
                        </td>
                        <td>${(product.priceSale || product.price) * product.quantity}.00</td>
                    </tr>
                    `
                }).join(' ')
                html += `
                <tr>
                    <td colspan="5"></td>
                    <td>
                        <button type="button" class="btn btn-success btn-cart" onclick="updateCart()">Cập nhật giỏ hàng</button>
                    </td>
                </tr>
                `
                $('.cart-content table tbody').html(html)
                $(".quantity").inputSpinner();

                let cartTotal = `
                    <div class="col-md-6 col-sm-12">
                        <h3>Chi tiết giỏ hàng</h3>
                        <table class="table">
                            <thead>
                                <tr>
                                <th scope="col">Tổng cộng</th>
                                <th scope="col">${total}.00</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Phí giao hàng</td>
                                    <td>
                                        <p>Miễn phí vận chuyển</p>
                                        <p>Tùy chọn vận chuyển sẽ được cập nhật trong quá trình thanh toán.</p>
                                        <p>Tính toán vận chuyển <i class="fa fa-motorcycle" aria-hidden="true"></i></p>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="col">Tổng cộng</th>
                                    <th scope="col">${total}.00</th>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td>
                                        <button type="button" class="btn btn-success btn-cart">Thanh toán</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `
                $('.cart-total').html(cartTotal)
            }
        }
        function updateCart() {
            const newQuantityList = Array.from(document.querySelectorAll('td input.product_quantity'))
                .filter((e) => !$(e).hasClass('form-control'))
                .map((e) => Number($(e).val()))
            let cart = JSON.parse(localStorage.getItem('cart') || '[]')
            for(let i=0; i < newQuantityList.length; i++) {
                cart[i].quantity = newQuantityList[i]
            }
            localStorage.setItem('cart', JSON.stringify(cart))
            generateCart()
        }
        $("document").ready(function() {
            generateCategoriesSubmenu();
            generateCart();
            displayCartQuantity()

        })
    </script>
</body>
</html>